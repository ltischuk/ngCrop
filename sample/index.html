<html ng-app="demo">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <style>
    .hideme {
      visibility: hidden;
    }
    .margin10 {
      margin-top:10px;
    }

  </style>
  <title title>NgCrop Example</title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.28/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.0/ui-bootstrap.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.0/ui-bootstrap-tpls.js"></script>
  <script src="../dist/unminified/ngcrop.js"></script>
  <script type="text/javascript">
    var app = angular.module('demo', ['ngcrop']);
    app
            .controller('ngcropDemoController', function($scope) {
              $scope.accessor= {};
              $scope.isReadyForCrop = false;
              $scope.croppedImageDataUrl = undefined;
              $scope.cropViewActivated = false;


              $scope.updateImageView = function(fileUrl){

                console.log('updating image view: ');
//                var img = new Image();
//                img.onload = function () {

                  $scope.$apply(
                    function() {
                      $scope.origImageDataUrl = fileUrl;

                        if($scope.accessor.processNewDataUrl){

                            $scope.accessor.processNewDataUrl(fileUrl);

                        }

                      $scope.isReadyForCrop = true;
                      $scope.cropViewActivated = true;
                    });

                //}
                //img.src = imageFileSrc;

              }

              $scope.onCanvasImgProcess = function(){

                $scope.cropViewActivated = true;

              }

              $scope.crop = function(){

                $scope.isReadyForCrop = false;

              }

              $scope.revertCrop = function(){

                $scope.isReadyForCrop = true;

              }

            })
            .directive('filereader',
            function () {

              return {

                restrict: 'A'
                ,scope : {
                  onFileUpload: '&'
                }
                ,link: function (scope, elem, attrs) {


                  elem.on('change',readFile);

                  function readFile(){

                      if (this.files && this.files[0]) {

                          //show a modal
                          var reader = new FileReader();
                          reader.onload = function (e) {

                              if (scope.onFileUpload) {
                                  scope.onFileUpload({fileUrl: e.target.result});
                              }

                          }

                          reader.readAsDataURL(this.files[0]);

                      }

                  }

                }

              }


            })
  </script>
</head>
<body ng-controller="ngcropDemoController">
<div>
  <h2 style="text-align: center">Drag corners to expand and/or collapse or click and drag center to move entire square</h2>
  <div>
    <div style="text-align: center">
      <!--<div data-ng-show="!cropViewActivated" class="col-xs-6 col-xs-offset-3 col-sm-2 col-sm-offset-5">-->
        <!--&lt;!&ndash;<input type="file" id="mainuploadfile" accept="image/jpeg, image/JPG, image/JPEG, image/jpeg" filereader&ndash;&gt;-->
               <!--&lt;!&ndash;on-file-upload="updateImageView(file)" capture="camera" />&ndash;&gt;-->
        <!--&lt;!&ndash;&lt;!&ndash;<button&ndash;&gt;&ndash;&gt;-->
                <!--&lt;!&ndash;&lt;!&ndash;on-tap&ndash;&gt;&ndash;&gt;-->
                <!--&lt;!&ndash;&lt;!&ndash;class="btn btn-block" trigger-upload >&ndash;&gt;&ndash;&gt;-->
          <!--&lt;!&ndash;&lt;!&ndash;Upload a file&ndash;&gt;&ndash;&gt;-->
        <!--&lt;!&ndash;&lt;!&ndash;</button>&ndash;&gt;&ndash;&gt;-->
      <!--</div>-->
      <crop-image
              data-ng-show="isReadyForCrop"
              data-ng-class="{'hideme' : !cropViewActivated}"
              add-canvas-border="true"
              max-img-display-length="300"
              selector-color="#FF0000"
              selector-line-width="2"
              cropped-img-data="croppedImageDataUrl"
              post-canvas-img-process-callback="onCanvasImgProcess(canvasInfo)"
              accessor="accessor"></crop-image>
      <img data-ng-src="{{croppedImageDataUrl}}" data-ng-show="!isReadyForCrop && cropViewActivated" height="200px" width="200px">
    </div>
    <div class="row" data-ng-show="cropViewActivated" style="margin-top: 20px"></div>
    <div class="row" data-ng-show="cropViewActivated">
      <div class="col-xs-6 col-xs-offset-3 col-sm-2 col-sm-offset-5" data-ng-show="isReadyForCrop">
        <button
                on-tap
                class="btn btn-deep-red btn-block"
                data-ng-click="crop()">
          Crop
        </button>
      </div>
      <div class="col-xs-6 col-xs-offset-3 col-sm-2 col-sm-offset-5" data-ng-show="!isReadyForCrop">
        <button
                on-tap
                class="btn btn-deep-red btn-block"
                data-ng-click="revertCrop()">
          Revert
        </button>
      </div>
    </div>
     <div class="col-xs-6 col-xs-offset-3 col-sm-2 col-sm-offset-5 margin10">
          <input type="file" id="reupload" accept="image/*" capture="camera" filereader
                 on-file-upload="updateImageView(fileUrl)"/>
      <!--<button-->
      <!--on-tap-->
      <!--class="btn btn-block">-->
      <!--Reupload a file-->
      <!--</button>-->
    </div>
  </div>
</div>
</body>
</html>
